"""
A client for exploitservice. It can be used to either enable or
disable existing exploits. If the exploit does not yet exists,
it will be created. So this is also a way to add new exploits
to the database.
"""
import sys
import os.path

from .exploitdb import ExploitDB

if len(sys.argv) < 5:
    print("usage:",sys.argv[0], "<service> <exploit> <port> <enable>")
    sys.exit(1)

SERVICE = sys.argv[1]
EXPLOIT = sys.argv[2]

if not os.path.isfile(EXPLOIT):
    print('Not a valid file: {}'.format(EXPLOIT))
    print('Please provide the absolute path to the exploit executable.')
    sys.exit(1)

try:
    PORT = int(sys.argv[3])
except:
    print('Invalid port: {}'.format(sys.argv[3]))
    sys.exit(1)

if sys.argv[4] in [1, 'TRUE', 'True', 'true', True]:
    ENABLED = True
elif sys.argv[4] in [0, 'FALSE', 'False', 'false', False]:
    ENABLED = False
else:
    print('Invalid value for enable: {}'.format(sys.argv[4]))
    sys.exit(1)

try:
    db = ExploitDB()
    db.update_exploit(SERVICE, EXPLOIT, PORT, ENABLED)
    print('Successfully added exploit')
except Exception as e:
    print(e)
    sys.exit(1)